# coding=utf-8
"""
This file demonstrates writing tests using the unittest module. These will pass
when you run "manage.py test".

Replace this with more appropriate tests for your application.
"""

from django.test import TestCase
from updater import *
from models import Rss, Info


class SimpleTest(TestCase):
    def test_basic_addition(self):
        """
        Tests that 1 + 1 always equals 2.
        """
        self.assertEqual(1 + 1, 2)


class ModelTest(TestCase):
    def setUp(self):
        self.r = Rss.objects.create(
            sort='AN',
            title='[萌月字幕组][Little Busters! Refrain][10][简繁][1280x720 AAC]',
            link='magnet:?xt=urn:btih:eff8325811f06fa232c4d91b88f0fa937ad3d7a6',
            hash_code="eff8325811f06fa232c4d91b88f0fa937ad3d7a6",
            timestamp="2013-09-09 11:11+08:00"
        )

    def test_model_save(self):
        self.assertEqual(self.r.sort, 'AN')
        self.assertIsNotNone(self.r.timestamp, 'should not be none')


class RssUpdaterTest(TestCase):
    def setUp(self):
        self.json = '{"count":50,"value":{"title":"KTXP","description":"Pipes Output","link":"http://pipes.yahoo.com/pipes/pipe.info?_id=2a1aee3dda9a657eaa4d8eece5441f8f","pubDate":"Sat, 14 Dec 2013 14:22:08 +0000","generator":"http://pipes.yahoo.com/pipes/","callback":"","items":[{"hash":"ce185c6c834ccda046f36d31deaeb0f2f19a5a4c","title":"【豌豆字幕组】[黏黏糊糊!!角质君Nyuru Nyuru!!KAKUSEN kun][14][GB简体][720p][MP4][百度分流]","url":"http://bt.ktxp.com/down/1387031017/ce185c6c834ccda046f36d31deaeb0f2f19a5a4c.torrent","description":null},{"hash":"5f6ea1dac2c1380d6a71fb9c675530f29abe2aee","title":"【豌豆字幕組】[黏黏糊糊!!角質君Nyuru Nyuru!!KAKUSEN kun][14][BIG5繁體][720p][MP4][百度分流]","url":"http://bt.ktxp.com/down/1387030971/5f6ea1dac2c1380d6a71fb9c675530f29abe2aee.torrent","description":null},{"hash":"e6ece4dbbb15bb77f4bc77f53167945bf79671c7","title":"【豌豆字幕組】[黏黏糊糊!!角質君Nyuru Nyuru!!KAKUSEN kun][12][BIG5繁體][720p][MP4][百度分流]","url":"http://bt.ktxp.com/down/1387030907/e6ece4dbbb15bb77f4bc77f53167945bf79671c7.torrent","description":null},{"hash":"98c88bf028b90b4a524157b24e4c761bc7c03d38","title":"【豌豆字幕组】[黏黏糊糊!!角质君Nyuru Nyuru!!KAKUSEN kun][12][GB简体][720p][MP4]","url":"http://bt.ktxp.com/down/1387030713/98c88bf028b90b4a524157b24e4c761bc7c03d38.torrent","description":null},{"hash":"20889f1cd1e16f0ece7de3e357e61c6135b34574","title":"【极影字幕社】★10月新番 LOG HORIZON / 记录的地平线 第11话 GB MP4 720p","url":"http://bt.ktxp.com/down/1387027386/20889f1cd1e16f0ece7de3e357e61c6135b34574.torrent","description":null},{"hash":"60b5482b932ad8f8892caf3787fafde817102f25","title":"【幻之字幕組】沒能成為勇者的我無可奈何的決定去工作 Yuushibu - 11[BIG5][720P][MP4](字幕組&COD成員招募)","url":"http://bt.ktxp.com/down/1387026154/60b5482b932ad8f8892caf3787fafde817102f25.torrent","description":null},{"hash":"65521abe55f441b800dfd800817978d9cf305df2","title":"【豬豬字幕組】★名偵探柯南 第733話「又甜又冰的送貨車(前篇)」【RMVB/繁體】[848x480]","url":"http://bt.ktxp.com/down/1387025980/65521abe55f441b800dfd800817978d9cf305df2.torrent","description":null},{"hash":"7be2c54fd098936d77908b76c010080e4b17d022","title":"【猪猪字幕组】★名侦探柯南 第733话「又甜又冰的送货车(前篇)」【RMVB/简体】[848x480]","url":"http://bt.ktxp.com/down/1387025717/7be2c54fd098936d77908b76c010080e4b17d022.torrent","description":null},{"hash":"19c5e9e869ac6bb24b5ec6785947fd943b87becb","title":"【幻之字幕组】沒能成为勇者的我无可奈何的决定去工作 Yuushibu - 11[GB][720P][MP4](字幕组&COD成员招募)","url":"http://bt.ktxp.com/down/1387025468/19c5e9e869ac6bb24b5ec6785947fd943b87becb.torrent","description":null},{"hash":"72e5f8ea44ae3d059015968985fd63759b587eec","title":"【DHR動研字幕組&生徒會字幕組】[青春紀行/金色年華_Golden Time][11][繁體][480P][MP4]","url":"http://bt.ktxp.com/down/1387023479/72e5f8ea44ae3d059015968985fd63759b587eec.torrent","description":null},{"hash":"f33f3b302a3468b57dc2255e60aff1b3d0c6d253","title":"【DHR動研字幕組&生徒會字幕組】[青春紀行/金色年華_Golden Time][11][繁體][720P][MP4]","url":"http://bt.ktxp.com/down/1387023475/f33f3b302a3468b57dc2255e60aff1b3d0c6d253.torrent","description":null},{"hash":"3301b0d5c4381682f7a77e449aea3493420146e9","title":"【ASAHI字幕組】泡麵番【黑魔女學園】[Kuromajo_san_ga_Touru!!]【52】[BIG5][720P][MP4]","url":"http://bt.ktxp.com/down/1387022578/3301b0d5c4381682f7a77e449aea3493420146e9.torrent","description":null},{"hash":"fc4dcc56ef7bb8babcdd32eec0b4c768c0b2f139","title":"[银光字幕组][蜡笔小新Crayon Shin-chan][818][GB][2013.12.14]打扫要利索完成哦&梦中的餐厅哦[720P][MP4]","url":"http://bt.ktxp.com/down/1387019730/fc4dcc56ef7bb8babcdd32eec0b4c768c0b2f139.torrent","description":null},{"hash":"c7b621e9e2c68fba47df8839da5cde9c38226f04","title":"【〇酱字幕组】[Super Seisyun Brothers -超青春姐弟s-][第14话][END][GB][720P][MP4]","url":"http://bt.ktxp.com/down/1387016981/c7b621e9e2c68fba47df8839da5cde9c38226f04.torrent","description":null},{"hash":"8b5a90548fce319494f366f5e3a54b1e579551a0","title":"[Mobile Suit Gundam SEED Destiny HD Remaster机动战士高达SEED Destiny高清重制版][第36话][720P补帧60FPS][BIG5]","url":"http://bt.ktxp.com/down/1387013922/8b5a90548fce319494f366f5e3a54b1e579551a0.torrent","description":null},{"hash":"a18eb004140df1d501f77827997a2f06c3c1dad6","title":"【DHR動研字幕組】[萌萌侵略者 OUTBREAK COMPANY][11][繁體][480P][MP4]","url":"http://bt.ktxp.com/down/1387013589/a18eb004140df1d501f77827997a2f06c3c1dad6.torrent","description":null},{"hash":"8b49d9ef0e88626067126cd3873462884491326c","title":"【DHR動研字幕組】[萌萌侵略者 OUTBREAK COMPANY][11][繁體][720P][MP4]","url":"http://bt.ktxp.com/down/1387013307/8b49d9ef0e88626067126cd3873462884491326c.torrent","description":null},{"hash":"2ea30d88b98e0d60e1f0538211d175926e77c5c4","title":"【生徒会字幕组】[10月新番][没能成为勇者的我，无可奈何决定去工作。][第11话][简体][720P][MP4]","url":"http://bt.ktxp.com/down/1387009979/2ea30d88b98e0d60e1f0538211d175926e77c5c4.torrent","description":null},{"hash":"a8f1e3fd81cb4280c61335d71489511d3b2ca6c0","title":"【生徒會字幕組】[10月新番][沒能成為勇者的我，無可奈何決定去工作。][第11話][繁體][720P][MP4]","url":"http://bt.ktxp.com/down/1387009939/a8f1e3fd81cb4280c61335d71489511d3b2ca6c0.torrent","description":null},{"hash":"298968e2ba75109fab0de5eb1729f46c94fe5f44","title":"[银光字幕组][哆啦A梦新番Doraemon][351][GB][2013.12.14]毛皮环&让圣诞节闪闪发光大作战[720P][MP4].mp4","url":"http://bt.ktxp.com/down/1387009248/298968e2ba75109fab0de5eb1729f46c94fe5f44.torrent","description":null},{"hash":"522a0773003eff52164127646b1f62ee36ba6bfc","title":"【Dymy字幕組】【Kakumeiki Valvrave_革命機 Valvrave】【第22話】【BIG5】【1280X720】【MP4】","url":"http://bt.ktxp.com/down/1387007558/522a0773003eff52164127646b1f62ee36ba6bfc.torrent","description":null},{"hash":"1f86e93a69d5647d1d9d8d0798dcf1f81cc32ec5","title":"[银光字幕组][宠物小精灵XY Pokemon XY][10][BIG5][720P][mp4]","url":"http://bt.ktxp.com/down/1387006685/1f86e93a69d5647d1d9d8d0798dcf1f81cc32ec5.torrent","description":null},{"hash":"62826c40e2773840f142fc3ee2d8735b40a4ef8e","title":"[银光字幕组][宠物小精灵XY Pokemon XY][10][GB][720P][mp4]","url":"http://bt.ktxp.com/down/1387005657/62826c40e2773840f142fc3ee2d8735b40a4ef8e.torrent","description":null},{"hash":"8cf0dc59c4db304299a9df7bdd5cfc5f0c2a9810","title":"[樱律字幕组][蓝宝石之谜(海底两万里)][06][中日双语字幕][720P]","url":"http://bt.ktxp.com/down/1387004578/8cf0dc59c4db304299a9df7bdd5cfc5f0c2a9810.torrent","description":null},{"hash":"f94d9e7c2ab4e11f6e42555f3fdeb3473efcd9bd","title":"[澄空学园] Walkure Romanze 少女骑士物语 第10话 MKV 720p 简繁外挂","url":"http://bt.ktxp.com/down/1387003883/f94d9e7c2ab4e11f6e42555f3fdeb3473efcd9bd.torrent","description":null},{"hash":"9b6b0bab9d09649869f49a7a5f4da3c4c5b33a0a","title":"[2013年10月番] 天香字幕社&A.I.R.nesSub Samurai Flamenco 弗拉明戈武士 10话 720p 简体内嵌","url":"http://bt.ktxp.com/down/1386996328/9b6b0bab9d09649869f49a7a5f4da3c4c5b33a0a.torrent","description":null},{"hash":"869d5faf7943af424e714222e78bdf058db660aa","title":"[2013年10月番] 天香字幕社&A.I.R.nesSub Samurai Flamenco 弗拉明戈武士 10话 720p 繁體內嵌","url":"http://bt.ktxp.com/down/1386996174/869d5faf7943af424e714222e78bdf058db660aa.torrent","description":null},{"hash":"52151831c3dcaa3072e9f54cf931feb38ed815b7","title":"[动漫国字幕组x轻之国度字幕组]★10月新番[噬血狂袭/Strike The Blood][11][720P][简体][MP4]","url":"http://bt.ktxp.com/down/1386994839/52151831c3dcaa3072e9f54cf931feb38ed815b7.torrent","description":null},{"hash":"76f790cc8496f43350399c8914bfcdb9877e3ef9","title":"【極影字幕社】★ 10月新番 没能成为勇者的我，无可奈何决定去工作。 第11話 BIG5 720p MP4","url":"http://bt.ktxp.com/down/1386993813/76f790cc8496f43350399c8914bfcdb9877e3ef9.torrent","description":null},{"hash":"51750b328d0a2a55c4d3868ddd63625e34d9d058","title":"【极影字幕社】★ 10月新番 没能成为勇者的我，无可奈何决定去工作。 第11话 GB 720p MP4","url":"http://bt.ktxp.com/down/1386987337/51750b328d0a2a55c4d3868ddd63625e34d9d058.torrent","description":null},{"hash":"b9aa6f73e7f54b88f5606b3fb8a5f02e26a1a37f","title":"【惡魔島字幕組】★10月新番【當不成勇者的我，只好認真找工作了。】[11][BIG5][720P][MP4]","url":"http://bt.ktxp.com/down/1386984856/b9aa6f73e7f54b88f5606b3fb8a5f02e26a1a37f.torrent","description":null},{"hash":"34e06cc25a3f533a9e1dd06b60b31458608af8a3","title":"[2013年10月番] 天香字幕社&A.I.R.nesSub Samurai Flamenco 弗拉明戈武士 10话 720p 简繁日外挂","url":"http://bt.ktxp.com/down/1386983363/34e06cc25a3f533a9e1dd06b60b31458608af8a3.torrent","description":null},{"hash":"11ca7793aaa48ab6b09fde1d60bd3765ddb3eee6","title":"【Dymy字幕組】【青春紀行/金色时光 Golden Time】【11】【BIG5】【1280X720】【MP4】","url":"http://bt.ktxp.com/down/1386981593/11ca7793aaa48ab6b09fde1d60bd3765ddb3eee6.torrent","description":null},{"hash":"05bc9a58a6eae04bd81d874899e134cb43621314","title":"【恶魔岛字幕组】★10月新番【当不成勇者的我，只好认真找工作了。】[11][GB][720P][MP4]","url":"http://bt.ktxp.com/down/1386980574/05bc9a58a6eae04bd81d874899e134cb43621314.torrent","description":null},{"hash":"b6671cdb55010aaf68141c8ced566f6ff0640837","title":"【紫音字幕组&dmlxg】★十月新番【当不成勇者的我只好认真找工作了】[11][简体][720P][MP4]","url":"http://bt.ktxp.com/down/1386979919/b6671cdb55010aaf68141c8ced566f6ff0640837.torrent","description":null},{"hash":"78bcf3c07a1bde18386cd34ef1d33992f3ebc3c1","title":"【Dymy字幕組】【東京暗鴉 Tokyo Ravens】【10v2】【BIG5】【1280X720】【MP4】","url":"http://bt.ktxp.com/down/1386978739/78bcf3c07a1bde18386cd34ef1d33992f3ebc3c1.torrent","description":null},{"hash":"c23109fc5771f723c28ccd2f70232f29a8866b82","title":"【幻之字幕組】噬血狂襲 Strike the Blood - 11[BIG5][720P][PSV&PC][MP4](字幕組&COD成員招募)","url":"http://bt.ktxp.com/down/1386978160/c23109fc5771f723c28ccd2f70232f29a8866b82.torrent","description":null},{"hash":"d5aa8c8c396e292500465521715727a8acc5ab76","title":"【紫音字幕組&dmlxg】★十月新番【當不成勇者的我只好認真找工作了】[11][繁體][720P][MP4]","url":"http://bt.ktxp.com/down/1386978091/d5aa8c8c396e292500465521715727a8acc5ab76.torrent","description":null},{"hash":"c697455dc46f9e6cc6bd7ee6fa4424d300c6169f","title":"[澄空学园] Strike the Blood/噬血狂袭 第11话 MP4 720p","url":"http://bt.ktxp.com/down/1386976445/c697455dc46f9e6cc6bd7ee6fa4424d300c6169f.torrent","description":null},{"hash":"98cc3d034d64469a4ebef064a3964c268f971d8d","title":"【RH字幕组】噬血狂襲[Strike The Blood][11][BIG5][720P][MP4]","url":"http://bt.ktxp.com/down/1386974025/98cc3d034d64469a4ebef064a3964c268f971d8d.torrent","description":null},{"hash":"2d1e02fd9897501c403f93ea18fc9a2388be5449","title":"[澄空学园] Strike the Blood/噬血狂袭 第10话 MKV 720p 简体外挂","url":"http://bt.ktxp.com/down/1386974017/2d1e02fd9897501c403f93ea18fc9a2388be5449.torrent","description":null},{"hash":"dbe0ad8406989fda1cbf2ed003d00a22fa3fc6c3","title":"[動漫國字幕組x輕之國度字幕組]★10月新番[噬血狂襲/Strike The Blood][11][720P][繁體][MP4]","url":"http://bt.ktxp.com/down/1386972080/dbe0ad8406989fda1cbf2ed003d00a22fa3fc6c3.torrent","description":null},{"hash":"898be8e0081241f8df21243221a7cfc78bfcad8b","title":"【幻之字幕组】噬血狂袭 Strike the Blood - 11[GB][720P][PSV&PC][MP4](字幕组&COD成员招募)","url":"http://bt.ktxp.com/down/1386968534/898be8e0081241f8df21243221a7cfc78bfcad8b.torrent","description":null},{"hash":"19565c1484eade126110355d82bf3e4fba7a2bbe","title":"【極影字幕社】 ★10月新番 【噬血狂襲】【Strike the blood】 第11話 BIG5 MP4_720P","url":"http://bt.ktxp.com/down/1386967819/19565c1484eade126110355d82bf3e4fba7a2bbe.torrent","description":null},{"hash":"8f91e8c1faaefde98b0bcdf1d77a33b2f0ad7542","title":"【Dymy字幕組】【噬血狂襲 Strike The Blood】【11】【BIG5】【1280X720】【MP4】","url":"http://bt.ktxp.com/down/1386967172/8f91e8c1faaefde98b0bcdf1d77a33b2f0ad7542.torrent","description":null},{"hash":"3df354081880f0495c1a00fb259994fb27771649","title":"【极影字幕社】 ★10月新番 【噬血狂袭】【Strike the blood】 第11话 GB MP4_720P","url":"http://bt.ktxp.com/down/1386965444/3df354081880f0495c1a00fb259994fb27771649.torrent","description":null},{"hash":"2466b04d704bb1d8b579946a6e6fa4367e7b4cbf","title":"[TUcaptions] 2013秋 // ゴールデンタイム / 青春紀行 / Golden Time // 11 // 720P-MP4-BIG5(繁)","url":"http://bt.ktxp.com/down/1386963754/2466b04d704bb1d8b579946a6e6fa4367e7b4cbf.torrent","description":null},{"hash":"51e8f0a1f896354ffeb3bc68d15714c45c02ba8f","title":"【動漫國字幕組&雪酷字幕組】★10月新番[魔笛MAGI 2][10][1280x720][簡繁外掛][MKV]","url":"http://bt.ktxp.com/down/1386961350/51e8f0a1f896354ffeb3bc68d15714c45c02ba8f.torrent","description":null},{"hash":"bc46ef40a80dfee8f91e158fc4599ba6e348f176","title":"【動漫國字幕組】★10月新番[Little Busters!~Refrain~][10][1280x720][簡繁外掛][MKV]","url":"http://bt.ktxp.com/down/1386961348/bc46ef40a80dfee8f91e158fc4599ba6e348f176.torrent","description":null},{"hash":"fd2c5d750d4407836a62bb9afd7e8b6976ec3273","title":"[輕之國度字幕組][零度戰姬 振動/Freezing Vibration][第11話][720P][BIG5][MP4]","url":"http://bt.ktxp.com/down/1386959353/fd2c5d750d4407836a62bb9afd7e8b6976ec3273.torrent","description":null}]}}'

    def test_updater_loop(self):
        loop_counter = save_rss("AN", json.loads(self.json)['value']['items'])
        self.assertGreater(loop_counter, 0, 'did not save file')
        # loop once more to make sure no duplicate rss added
        loop_counter = save_rss("AN", json.loads(self.json)['value']['items'])
        self.assertEqual(loop_counter, 0, 'Rss should be unique %s, %s' % (loop_counter, Rss.objects.all().count()))


class InfoUpdaterTest(TestCase):
    def setUp(self):
        self.rawJson = '[' \
                       '{"spid":14202,"title":"DIABOLIK LOVERS","cover":"http://i0.hdslb.com/sp/a9/a945e30a9152093aed9458ee9197a6a1.jpg","click":312637,"attention":2611,"bgmcount":12,"priority":0,"weekday":2,"lastupdate":1386605392,"mcover":"http://i0.hdslb.com/sp/a9/a945e30a9152093aed9458ee9197a6a1.jpg","scover":"http://i0.hdslb.com/sp/a9/a945e30a9152093aed9458ee9197a6a1.jpg","lastupdate_at":"2013-12-10 00:09","new":false},' \
                       '{"spid":6240,"title":"机巧少女不会受伤","cover":"http://i2.hdslb.com/sp/53/53f03fecf63ad0706df29990409ed76c.jpg","click":830387,"attention":6298,"bgmcount":10,"priority":0,"weekday":2,"lastupdate":1386603602,"mcover":"http://i2.hdslb.com/sp/53/53f03fecf63ad0706df29990409ed76c.jpg","scover":"http://i2.hdslb.com/sp/53/53f03fecf63ad0706df29990409ed76c.jpg","lastupdate_at":"2013-12-09 23:40","new":false},' \
                       '{"spid":16459,"title":"机动战士高达 BUILD FIGHTERS","cover":"http://i2.hdslb.com/sp/2d/2dfbd3affcd50217f92e43c4476cb36c.jpg","click":201392,"attention":687,"bgmcount":10,"priority":0,"weekday":2,"lastupdate":1386588533,"mcover":"http://i2.hdslb.com/sp/2d/2dfbd3affcd50217f92e43c4476cb36c.jpg","scover":"http://i2.hdslb.com/sp/2d/2dfbd3affcd50217f92e43c4476cb36c.jpg","lastupdate_at":"2013-12-09 19:28","new":false},' \
                       '{"spid":2926,"title":"白色相簿2","cover":"http://i2.hdslb.com/sp/80/80f18a053c140cb6d1e43ee30013da74.jpg","click":277058,"attention":1612,"bgmcount":10,"priority":0,"weekday":0,"lastupdate":1386588240,"mcover":"http://i2.hdslb.com/sp/80/80f18a053c140cb6d1e43ee30013da74.jpg","scover":"http://i2.hdslb.com/sp/80/80f18a053c140cb6d1e43ee30013da74.jpg","lastupdate_at":"2013-12-09 19:24","new":false}' \
                       ']'
        self.twoInfoDropedJson = '[' \
                                 '{"spid":14202,"title":"DIABOLIK LOVERS","cover":"http://i0.hdslb.com/sp/a9/a945e30a9152093aed9458ee9197a6a1.jpg","click":312637,"attention":2611,"bgmcount":12,"priority":0,"weekday":2,"lastupdate":1386605392,"mcover":"http://i0.hdslb.com/sp/a9/a945e30a9152093aed9458ee9197a6a1.jpg","scover":"http://i0.hdslb.com/sp/a9/a945e30a9152093aed9458ee9197a6a1.jpg","lastupdate_at":"2013-12-10 00:09","new":false},' \
                                 '{"spid":16459,"title":"机动战士高达 BUILD FIGHTERS","cover":"http://i2.hdslb.com/sp/2d/2dfbd3affcd50217f92e43c4476cb36c.jpg","click":201392,"attention":687,"bgmcount":10,"priority":0,"weekday":2,"lastupdate":1386588533,"mcover":"http://i2.hdslb.com/sp/2d/2dfbd3affcd50217f92e43c4476cb36c.jpg","scover":"http://i2.hdslb.com/sp/2d/2dfbd3affcd50217f92e43c4476cb36c.jpg","lastupdate_at":"2013-12-09 19:28","new":false}' \
                                 ']'
        self.oneInfoNewJson = '[' \
                              '{"spid":14202,"title":"DIABOLIK LOVERS","cover":"http://i0.hdslb.com/sp/a9/a945e30a9152093aed9458ee9197a6a1.jpg","click":312637,"attention":2611,"bgmcount":12,"priority":0,"weekday":2,"lastupdate":1386605392,"mcover":"http://i0.hdslb.com/sp/a9/a945e30a9152093aed9458ee9197a6a1.jpg","scover":"http://i0.hdslb.com/sp/a9/a945e30a9152093aed9458ee9197a6a1.jpg","lastupdate_at":"2013-12-10 00:09","new":false},' \
                              '{"spid":16459,"title":"机动战士高达 BUILD FIGHTERS","cover":"http://i2.hdslb.com/sp/2d/2dfbd3affcd50217f92e43c4476cb36c.jpg","click":201392,"attention":687,"bgmcount":10,"priority":0,"weekday":2,"lastupdate":1386588533,"mcover":"http://i2.hdslb.com/sp/2d/2dfbd3affcd50217f92e43c4476cb36c.jpg","scover":"http://i2.hdslb.com/sp/2d/2dfbd3affcd50217f92e43c4476cb36c.jpg","lastupdate_at":"2013-12-09 19:28","new":false},' \
                              '{"spid":3306,"alias_spid":3306,"title":"心跳！光之美少女（第八代 第十季）","cover":"http://i0.hdslb.com/sp/98/98cd678bc8b8c64ee55f10e46192faee.jpg","click":152810,"attention":355,"bgmcount":43,"priority":0,"weekday":1,"lastupdate":1386514714,"mcover":"http://i0.hdslb.com/sp/98/98cd678bc8b8c64ee55f10e46192faee.jpg","scover":"http://i0.hdslb.com/sp/98/98cd678bc8b8c64ee55f10e46192faee.jpg","lastupdate_at":"2013-11-10 21:02","new":false}' \
                              ']'

    def test_clean_info_title(self):
        # TODO: for Ricter
        self.assertEqual(clean_info_title('机巧少女不会受伤'), '机巧少女不会受伤')
        self.assertEqual(clean_info_title('心跳！光之美少女（第八代 第十季）'), '心跳！光之美少女')
        self.assertEqual(clean_info_title('黑子的篮球 第二季'), '黑子的篮球')
        self.assertEqual(clean_info_title('第一神拳 Rising（第三季）'), '第一神拳 Rising')

    def test_update_info_list(self):
        # TODO: for Ricter
        update_info_list('AN', json.loads(self.rawJson))
        self.assertEqual(Info.objects.all().count(), 4, 'add 4 info')
        self.assertEqual(Info.objects.filter(title='机巧少女不会受伤').count(), 1, 'get 1 added')
        self.assertEqual(Info.objects.get(title='机巧少女不会受伤').sort, 'AN')
        self.assertEqual(Info.objects.get(title='机巧少女不会受伤').now_playing, '连载中')

        # get the next json
        update_info_list('AN', json.loads(self.twoInfoDropedJson))
        self.assertEqual(Info.objects.all().count(), 4, 'No more info added')
        self.assertEqual(Info.objects.get(title='机巧少女不会受伤').now_playing, '已完结')
        self.assertEqual(Info.objects.get(title='白色相簿2').now_playing, '已完结')

        # a new info to add
        update_info_list('AN', json.loads(self.oneInfoNewJson))
        self.assertEqual(Info.objects.all().count(), 5, 'A new one, so should be 5')
        self.assertEqual(Info.objects.get(title='机巧少女不会受伤').now_playing, '已完结')
        self.assertEqual(Info.objects.get(title='白色相簿2').now_playing, '已完结')
        self.assertEqual(Info.objects.get(title='心跳！光之美少女').now_playing, '连载中')
